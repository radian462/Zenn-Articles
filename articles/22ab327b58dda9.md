---
title: "NorthflankでDiscord Botを無料で常時起動"
emoji: "👌"
type: "tech"
topics:
  - "discord"
  - "インフラ"
  - "discordpy"
  - "northflank"
published: true
published_at: "2024-10-09 15:08"
---

[Northflank](https://northflank.com)というサービスでDiscord Botを動かす方法をまとめました。
この記事で紹介するとき、日本語の記事が見つからなかったのでないなら書けばいいじゃないというマリー・アントワネット的な思考で描きました
https://zenn.dev/radian462/articles/907966dde6cb9f

# Northflankとは
Discord Botの常時起動の方法でよく聞く[Heroku](https://jp.heroku.com)と同じPaaS (Platform as a Service) にあたるサービスです。(ただし、Herokuの無料枠は廃止されています。)  
GitHubやGitLabなどと連携すると、リポジトリから簡単にデプロイでき、CI/CD機能によりプッシュ時に自動でデプロイされて便利です。  

Python、Ruby、Rust、PHP、TypeScript、React、Vue.jsなどが動作します。サンプルコードも用意されています。  
[こちら](https://github.com/northflank-examples)から確認できます。  

Developer Sandboxプランでは、0.2 shared CPU、512MBのRAM、1GBのストレージのマシンを2つ利用できます。

# 言語
Python 3.11

# 用意するもの
- Botのリポジトリ
- クレジットカードまたはデビットカード（プリペイドカードが使えるかどうかは不明）

# テストコード
https://github.com/radian462/test-bot

このコードは[こちらの記事](https://qiita.com/Erytheia/items/2f64c06d6d8a4f802390)のコードをベースに作成させていただきました。

# 登録
メアド、Google、GitHub、GitLab、BitBucketでの登録ができます。
自分のリポジトリを使うならGitHub、GitLab、BitBucketのどれかの方がいいです。
![](https://storage.googleapis.com/zenn-user-upload/4d9fe9a7ddbc-20241008.jpeg)


次に出てくるページでユーザー名を登録してしてください。(写真撮り忘れた)


ここでは`2`で`Developer Sandbox`を選んでおけばいいです。
![](https://storage.googleapis.com/zenn-user-upload/99689f305073-20241009.jpeg)

これで登録完了です。

# プロジェクト作成
まず、プロジェクトを作成します。
上の`Create New`から`Project`を選択してください。
![](https://storage.googleapis.com/zenn-user-upload/03f51cefb94c-20241009.jpeg)


`Project Name`には任意なプロジェクト名を選んで、リージョンはアメリカとイギリスの好きな方を選んでください。
![](https://storage.googleapis.com/zenn-user-upload/402bddf4923e-20241009.jpeg)

これでプロジェクトは完成です。

# デプロイ
いよいよDiscord Botをデプロイしていきます。
まず先ほどと同様に`Create New`を押して、今度は`Service`を選択してください。

`Service name`には任意の名前を入れてください。
`Repositry`には自分のリポジトリを選択するか、リポジトリのURLを入れてください。
GitHub等でアカウントを作っていたら自動で自分のリポジトリが選べるようになっているはずです。(違ったらすみません。)
![](https://storage.googleapis.com/zenn-user-upload/356be1ab73b9-20241009.jpeg)

ビルド方法には`Dockerfile`と`Heroku Buildpack`があるのですが、今回は`Dockerfile`にします。
`Dockerfile`を選択するとリポジトリから自動で読み取ってポートなどの設定を自動でやってくれます。
もし自動で読み取れないなら`Verify`を押して読み取らせてください。
![](https://storage.googleapis.com/zenn-user-upload/e47ffb562e53-20241009.jpeg)

次に、`Environment variables`の`Runtime variables`をクリックして、環境変数を設定していきます。
`Add variable`をクリックしてテストコードの場合だとKeyにDISCORD_TOKENと入れて、ValueにBotのTokenを入れてください。
jsonやenvの形式で入れることもできます。
![](https://storage.googleapis.com/zenn-user-upload/2d13bf7d7e99-20241009.jpeg)

最後にマシンのスペックを設定していきます。
Developer Sandboxプランなら2つまで`nf-compute-10`でも`nf-compute-20`でも無料なので特別な理由がないなら`nf-compute-20`に変えましょう。
![](https://storage.googleapis.com/zenn-user-upload/8facaa45c6f0-20241009.jpeg)

そして`Create Serivce`を押してデプロイ...って言いたいところですが支払い方法を追加していないとここでカードで認証するように言われるのでカードを追加しましょう。(プリペイドカード使えたかは覚えてません。デビットは使える。)
Developer Sandboxプランから変えなければ請求が来ることはありません。(料金改訂があるかもしれないので決済履歴や料金は定期的に見るようにしましょう。)

追加したら自動でデプロイが開始されます。
デプロイから起動までは数分程度かかるので少し待ちましょう。

Botがオンラインになりました。
![](https://storage.googleapis.com/zenn-user-upload/cd355a98762f-20241009.jpeg)

# おわりに
使ってみた感想として環境変数にjsonやenvが使えることや、無料枠を超えてしまう機能は警告や制限がされて請求が発生しないようになっているUIが気に入りました。
過去のデプロイのログも結構残っているのでそれも高評価。(いつまで保管されているか不明)
Northflankで半年くらいBlueskyのBotをデプロイしてますが、今の所ダウンしていることはあっても気づかないくらいしかないです。
無料枠の中では比較的高いスペックのマシンが2つ使えるので、他の用途にも使えて結構おすすめです。
最後まで読んでいただきありがとうございました。

↓Northflankで運用しているBot
https://bsky.app/profile/train-kanto.f5.si
https://bsky.app/profile/train-kansai.f5.si